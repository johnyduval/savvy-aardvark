<!doctype html>

<head>
  <meta charset="utf-8">

  <title>Your Food Profile</title>
  <meta name="description" content="Your Food Profile">
  <meta name="viewport" content="width=device-width">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.parsecdn.com/js/parse-latest.js"></script>
</head>

<body>

  <div id="main">

    <!--Sign up form-->
    <h1>Sign Up</h1>

    <form id="signup">
      <p>
        <input type="text" id="signup-name" />
      </p>
      <p>
        <input type="password" id="signup-password" />
      </p>
      <p>
        <input type="submit" id="signup-submit" />
      </p>
    </form>

    <!--Log out!-->
    <h1> Log out</h1>

    <div>
      <button id="logout">Logout</button>
    </div>

    <!--Diet Profile-->

    <h1>Choose your diet profile</h1>

    <form id="diet_profile">
      <p>
        <input type="radio" name="diet" value="Vegetarian" id="vegetarian_profile" />Vegetarian</p>
      <p>
        <input type="radio" name="diet" value="Vegan" id="vegan_profile" />Vegan</p>
      <p>
        <input type="radio" name="diet" value="Paleo" id="paleo_profile" />Paleo</p>
      <p>
        <input type="submit" />
      </p>
    </form>

    <!--List to avoid-->
    <form id="to_avoid">

    </form>

    <script type="text/javascript">
      Parse.initialize("xMN2SDWbUpH0Tius0RAscb5Ia65CGOD7U1qKtAxH", "wlqxDznzkziAQB2hNhMFu5VKXvwKskjDonIhlSNn");

      var User = Parse.Object.extend("User");

      $('#logout').click(function(event) {
        Parse.User.logOut()
      });

      $("#signup").submit(function(event) {
        event.preventDefault();


        var name = $("#signup-name").val();
        var pass = $("#signup-password").val();
        // console.log(name, pass);

        // var user = new Parse.User();

        // user.set("username", name);
        // user.set("password", pass);

        /*user*/
        Parse.User.signUp(name, pass, {
          success: function(user) {
            console.log("Welcome!");
          },
          error: function(user, error) {
            console.log("Sign up error: " + error.message);
          }

        });
      });

      $("#diet_profile").submit(function(event) {
        event.preventDefault();

        var diet = $("input:radio[name=diet]:checked").val();
        
        console.log(Parse.User.current());
        console.log(diet);
        
        var user = Parse.User.current();
  
        user.set("diet", diet);

        if (diet === "Vegetarian") {
          user.set("to_avoid", ['chicken', 'beef', 'pork']);
        }
        else if (diet === "Vegan") {
          user.set('to_avoid', ['chicken', 'beef', 'pork', 'eggs', 'milk']);
        }
        else if (diet === "Paleo")
          user.set('to_avoid', ['flour', 'bread', 'wheat', 'rice']);

        user.save({
          success: function(result) {

          },
          error: function(error) {
            console.log("Error: " + error.message);

          }
        });
      });


      // var query = new Parse.Query("User");

      // query.equalTo("objectId", currentUser.objectId);
      // query.find({
      //   success: function(results){
      //     for (var i=0; i < results.length; i++){
      //       $('#to_avoid').append('<p><input type="radio" name="to_avoid" value="' + results[i] + '" id="' + results[i] + '"/>' + results[i] + '</p>');
      //     }
      //   }, error: function(error){
      //     console.log("There's an error: " + error.message)
      //   }

      // });
    </script>
</body>

</html>
